From 728f988c09224a8e7f48ec02fd2fa7c76d047956 Mon Sep 17 00:00:00 2001
From: Alexandros Frantzis <alexandros.frantzis@collabora.com>
Date: Thu, 30 Sep 2021 11:24:36 +0300
Subject: [PATCH 104/165] winewayland.drv: Destroy GL drawable on window
 destruction.

Signed-off-by: Alexandros Frantzis <alexandros.frantzis@collabora.com>
---
 dlls/winewayland.drv/opengl.c     | 6 +++++-
 dlls/winewayland.drv/waylanddrv.h | 1 +
 dlls/winewayland.drv/window.c     | 1 +
 3 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/dlls/winewayland.drv/opengl.c b/dlls/winewayland.drv/opengl.c
index 12a5476165b..7db70fb0544 100644
--- a/dlls/winewayland.drv/opengl.c
+++ b/dlls/winewayland.drv/opengl.c
@@ -198,7 +198,7 @@ static void wayland_gl_drawable_clear_buffers(struct wayland_gl_drawable *gl)
         wayland_gl_buffer_destroy(gl_buffer);
 }
 
-static void wayland_destroy_gl_drawable(HWND hwnd)
+void wayland_destroy_gl_drawable(HWND hwnd)
 {
     struct wayland_gl_drawable *gl;
 
@@ -1627,4 +1627,8 @@ void wayland_update_gl_drawable_surface(HWND hwnd, struct wayland_surface *wayla
 {
 }
 
+void wayland_destroy_gl_drawable(HWND hwnd)
+{
+}
+
 #endif
diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index b3e02ba3fe5..730bd61b4ae 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -511,6 +511,7 @@ BOOL wayland_gbm_init(void) DECLSPEC_HIDDEN;
  */
 
 void wayland_update_gl_drawable_surface(HWND hwnd, struct wayland_surface *wayland_surface) DECLSPEC_HIDDEN;
+void wayland_destroy_gl_drawable(HWND hwnd) DECLSPEC_HIDDEN;
 
 /**********************************************************************
  *          Registry helpers
diff --git a/dlls/winewayland.drv/window.c b/dlls/winewayland.drv/window.c
index 84ddca2dc1b..d313e9ec77f 100644
--- a/dlls/winewayland.drv/window.c
+++ b/dlls/winewayland.drv/window.c
@@ -926,6 +926,7 @@ void WAYLAND_DestroyWindow(HWND hwnd)
     TRACE("%p\n", hwnd);
 
     if (!(data = wayland_win_data_get(hwnd))) return;
+    wayland_destroy_gl_drawable(hwnd);
     wayland_win_data_destroy(data);
 }
 
-- 
2.35.1

